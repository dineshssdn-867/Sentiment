"use strict";{const e={calendars:[],calendarInputs:[],clockInputs:[],clockHours:{default_:[[gettext_noop("Now"),-1],[gettext_noop("Midnight"),0],[gettext_noop("6 a.m."),6],[gettext_noop("Noon"),12],[gettext_noop("6 p.m."),18]]},dismissClockFunc:[],dismissCalendarFunc:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",timezoneWarningClass:"timezonewarning",timezoneOffset:0,init:function(){const t=document.body.dataset.adminUtcOffset;if(t){const n=-60*(new Date).getTimezoneOffset();e.timezoneOffset=n-t}for(const t of document.getElementsByTagName("input"))"text"===t.type&&t.classList.contains("vTimeField")?(e.addClock(t),e.addTimezoneWarning(t)):"text"===t.type&&t.classList.contains("vDateField")&&(e.addCalendar(t),e.addTimezoneWarning(t))},now:function(){const e=document.body.dataset.adminUtcOffset;if(e){const t=new Date,n=-60*t.getTimezoneOffset();return t.setTime(t.getTime()+1e3*(e-n)),t}return new Date},addTimezoneWarning:function(t){const n=e.timezoneWarningClass;let a,c=e.timezoneOffset/3600;if(!c)return;if(t.parentNode.querySelectorAll("."+n).length)return;c>0?a=ngettext("Note: You are %s hour ahead of server time.","Note: You are %s hours ahead of server time.",c):(c*=-1,a=ngettext("Note: You are %s hour behind server time.","Note: You are %s hours behind server time.",c)),a=interpolate(a,[c]);const o=document.createElement("span");o.className=n,o.textContent=a,t.parentNode.appendChild(document.createElement("br")),t.parentNode.appendChild(o)},addClock:function(t){const n=e.clockInputs.length;e.clockInputs[n]=t,e.dismissClockFunc[n]=function(){return e.dismissClock(n),!0};const a=document.createElement("span");a.className=e.shortCutsClass,t.parentNode.insertBefore(a,t.nextSibling);const c=document.createElement("a");c.href="#",c.textContent=gettext("Now"),c.addEventListener("click",function(t){t.preventDefault(),e.handleClockQuicklink(n,-1)});const o=document.createElement("a");o.href="#",o.id=e.clockLinkName+n,o.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.openClock(n)}),quickElement("span",o,"","class","clock-icon","title",gettext("Choose a Time")),a.appendChild(document.createTextNode(" ")),a.appendChild(c),a.appendChild(document.createTextNode(" | ")),a.appendChild(o);const i=document.createElement("div");i.style.display="none",i.style.position="absolute",i.className="clockbox module",i.id=e.clockDivName+n,document.body.appendChild(i),i.addEventListener("click",function(e){e.stopPropagation()}),quickElement("h2",i,gettext("Choose a time"));const d=quickElement("ul",i);d.className="timelist";const l=void 0===e.clockHours[t.name]?"default_":t.name;e.clockHours[l].forEach(function(t){quickElement("a",quickElement("li",d),gettext(t[0]),"href","#").addEventListener("click",function(a){a.preventDefault(),e.handleClockQuicklink(n,t[1])})});const s=quickElement("p",i);s.className="calendar-cancel",quickElement("a",s,gettext("Cancel"),"href","#").addEventListener("click",function(t){t.preventDefault(),e.dismissClock(n)}),document.addEventListener("keyup",function(t){27===t.which&&(e.dismissClock(n),t.preventDefault())})},openClock:function(t){const n=document.getElementById(e.clockDivName+t),a=document.getElementById(e.clockLinkName+t);"rtl"!==window.getComputedStyle(document.body).direction?n.style.left=findPosX(a)+17+"px":n.style.left=findPosX(a)-110+"px",n.style.top=Math.max(0,findPosY(a)-30)+"px",n.style.display="block",document.addEventListener("click",e.dismissClockFunc[t])},dismissClock:function(t){document.getElementById(e.clockDivName+t).style.display="none",document.removeEventListener("click",e.dismissClockFunc[t])},handleClockQuicklink:function(t,n){let a;a=-1===n?e.now():new Date(1970,1,1,n,0,0,0),e.clockInputs[t].value=a.strftime(get_format("TIME_INPUT_FORMATS")[0]),e.clockInputs[t].focus(),e.dismissClock(t)},addCalendar:function(t){const n=e.calendars.length;e.calendarInputs[n]=t,e.dismissCalendarFunc[n]=function(){return e.dismissCalendar(n),!0};const a=document.createElement("span");a.className=e.shortCutsClass,t.parentNode.insertBefore(a,t.nextSibling);const c=document.createElement("a");c.href="#",c.appendChild(document.createTextNode(gettext("Today"))),c.addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,0)});const o=document.createElement("a");o.href="#",o.id=e.calendarLinkName+n,o.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.openCalendar(n)}),quickElement("span",o,"","class","date-icon","title",gettext("Choose a Date")),a.appendChild(document.createTextNode(" ")),a.appendChild(c),a.appendChild(document.createTextNode(" | ")),a.appendChild(o);const i=document.createElement("div");i.style.display="none",i.style.position="absolute",i.className="calendarbox module",i.id=e.calendarDivName1+n,document.body.appendChild(i),i.addEventListener("click",function(e){e.stopPropagation()});const d=quickElement("div",i),l=quickElement("a",d,"<","href","#");l.className="calendarnav-previous",l.addEventListener("click",function(t){t.preventDefault(),e.drawPrev(n)});const s=quickElement("a",d,">","href","#");s.className="calendarnav-next",s.addEventListener("click",function(t){t.preventDefault(),e.drawNext(n)}),quickElement("div",i,"","id",e.calendarDivName2+n).className="calendar",e.calendars[n]=new Calendar(e.calendarDivName2+n,e.handleCalendarCallback(n)),e.calendars[n].drawCurrent();const r=quickElement("div",i);r.className="calendar-shortcuts";let u=quickElement("a",r,gettext("Yesterday"),"href","#");u.addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,-1)}),r.appendChild(document.createTextNode(" | ")),(u=quickElement("a",r,gettext("Today"),"href","#")).addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,0)}),r.appendChild(document.createTextNode(" | ")),(u=quickElement("a",r,gettext("Tomorrow"),"href","#")).addEventListener("click",function(t){t.preventDefault(),e.handleCalendarQuickLink(n,1)});const m=quickElement("p",i);m.className="calendar-cancel",quickElement("a",m,gettext("Cancel"),"href","#").addEventListener("click",function(t){t.preventDefault(),e.dismissCalendar(n)}),document.addEventListener("keyup",function(t){27===t.which&&(e.dismissCalendar(n),t.preventDefault())})},openCalendar:function(t){const n=document.getElementById(e.calendarDivName1+t),a=document.getElementById(e.calendarLinkName+t),c=e.calendarInputs[t];if(c.value){const n=get_format("DATE_INPUT_FORMATS")[0],a=c.value.strptime(n),o=a.getUTCFullYear(),i=a.getUTCMonth()+1;/\d{4}/.test(o.toString())&&i>=1&&i<=12&&e.calendars[t].drawDate(i,o,a)}"rtl"!==window.getComputedStyle(document.body).direction?n.style.left=findPosX(a)+17+"px":n.style.left=findPosX(a)-180+"px",n.style.top=Math.max(0,findPosY(a)-75)+"px",n.style.display="block",document.addEventListener("click",e.dismissCalendarFunc[t])},dismissCalendar:function(t){document.getElementById(e.calendarDivName1+t).style.display="none",document.removeEventListener("click",e.dismissCalendarFunc[t])},drawPrev:function(t){e.calendars[t].drawPreviousMonth()},drawNext:function(t){e.calendars[t].drawNextMonth()},handleCalendarCallback:function(t){let n=get_format("DATE_INPUT_FORMATS")[0];return n=n.replace("\\","\\\\").replace("\r","\\r").replace("\n","\\n").replace("\t","\\t").replace("'","\\'"),function(a,c,o){e.calendarInputs[t].value=new Date(a,c-1,o).strftime(n),e.calendarInputs[t].focus(),document.getElementById(e.calendarDivName1+t).style.display="none"}},handleCalendarQuickLink:function(t,n){const a=e.now();a.setDate(a.getDate()+n),e.calendarInputs[t].value=a.strftime(get_format("DATE_INPUT_FORMATS")[0]),e.calendarInputs[t].focus(),e.dismissCalendar(t)}};window.addEventListener("load",e.init),window.DateTimeShortcuts=e}