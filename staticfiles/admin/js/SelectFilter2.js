"use strict";window.SelectFilter={init:function(e,t,o){if(e.match(/__prefix__/))return;const l=document.getElementById(e);l.id+="_from",l.className="filtered";for(const e of l.parentNode.getElementsByTagName("p"))e.classList.contains("info")?l.parentNode.removeChild(e):e.classList.contains("help")&&l.parentNode.insertBefore(e,l.parentNode.firstChild);const n=quickElement("div",l.parentNode);n.className=o?"selector stacked":"selector";const i=quickElement("div",n);i.className="selector-available";const c=quickElement("h2",i,interpolate(gettext("Available %s")+" ",[t]));quickElement("span",c,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[t]));const s=quickElement("p",i,"","id",e+"_filter");s.className="selector-filter";const r=quickElement("label",s,"","for",e+"_input");quickElement("span",r,"","class","help-tooltip search-label-icon","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[t])),s.appendChild(document.createTextNode(" "));const a=quickElement("input",s,"","type","text","placeholder",gettext("Filter"));a.id=e+"_input",i.appendChild(l);const d=quickElement("a",i,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[t]),"href","#","id",e+"_add_all_link");d.className="selector-chooseall";const m=quickElement("ul",n);m.className="selector-chooser";const h=quickElement("a",quickElement("li",m),gettext("Choose"),"title",gettext("Choose"),"href","#","id",e+"_add_link");h.className="selector-add";const _=quickElement("a",quickElement("li",m),gettext("Remove"),"title",gettext("Remove"),"href","#","id",e+"_remove_link");_.className="selector-remove";const u=quickElement("div",n);u.className="selector-chosen";const f=quickElement("h2",u,interpolate(gettext("Chosen %s")+" ",[t]));quickElement("span",f,"","class","help help-tooltip help-icon","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[t])),quickElement("select",u,"","id",e+"_to","multiple","","size",l.size,"name",l.name).className="filtered";const p=quickElement("a",u,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[t]),"href","#","id",e+"_remove_all_link");p.className="selector-clearall",l.name=l.name+"_old";const g=function(t,o,l,n,i){o.classList.contains("active")&&(l(n,i),SelectFilter.refresh_icons(e)),t.preventDefault()};if(d.addEventListener("click",function(t){g(t,this,SelectBox.move_all,e+"_from",e+"_to")}),h.addEventListener("click",function(t){g(t,this,SelectBox.move,e+"_from",e+"_to")}),_.addEventListener("click",function(t){g(t,this,SelectBox.move,e+"_to",e+"_from")}),p.addEventListener("click",function(t){g(t,this,SelectBox.move_all,e+"_to",e+"_from")}),a.addEventListener("keypress",function(t){SelectFilter.filter_key_press(t,e)}),a.addEventListener("keyup",function(t){SelectFilter.filter_key_up(t,e)}),a.addEventListener("keydown",function(t){SelectFilter.filter_key_down(t,e)}),n.addEventListener("change",function(t){"SELECT"===t.target.tagName&&SelectFilter.refresh_icons(e)}),n.addEventListener("dblclick",function(t){"OPTION"===t.target.tagName&&(t.target.closest("select").id===e+"_to"?SelectBox.move(e+"_to",e+"_from"):SelectBox.move(e+"_from",e+"_to"),SelectFilter.refresh_icons(e))}),l.closest("form").addEventListener("submit",function(){SelectBox.select_all(e+"_to")}),SelectBox.init(e+"_from"),SelectBox.init(e+"_to"),SelectBox.move(e+"_from",e+"_to"),!o){const t=document.getElementById(e+"_from"),o=document.getElementById(e+"_to");let l=s.offsetHeight+t.offsetHeight;const n=window.getComputedStyle(o);"border-box"===n.getPropertyValue("box-sizing")&&(l+=parseInt(n.getPropertyValue("padding-top"),10)+parseInt(n.getPropertyValue("padding-bottom"),10)+parseInt(n.getPropertyValue("border-top-width"),10)+parseInt(n.getPropertyValue("border-bottom-width"),10)),o.style.height=l+"px"}SelectFilter.refresh_icons(e)},any_selected:function(e){e.required=!0;const t=e.checkValidity();return e.required=!1,t},refresh_icons:function(e){const t=document.getElementById(e+"_from"),o=document.getElementById(e+"_to");document.getElementById(e+"_add_link").classList.toggle("active",SelectFilter.any_selected(t)),document.getElementById(e+"_remove_link").classList.toggle("active",SelectFilter.any_selected(o)),document.getElementById(e+"_add_all_link").classList.toggle("active",t.querySelector("option")),document.getElementById(e+"_remove_all_link").classList.toggle("active",o.querySelector("option"))},filter_key_press:function(e,t){const o=document.getElementById(t+"_from");(e.which&&13===e.which||e.keyCode&&13===e.keyCode)&&(o.selectedIndex=0,SelectBox.move(t+"_from",t+"_to"),o.selectedIndex=0,e.preventDefault())},filter_key_up:function(e,t){const o=document.getElementById(t+"_from"),l=o.selectedIndex;SelectBox.filter(t+"_from",document.getElementById(t+"_input").value),o.selectedIndex=l},filter_key_down:function(e,t){const o=document.getElementById(t+"_from");if(e.which&&39===e.which||e.keyCode&&39===e.keyCode){const e=o.selectedIndex;return SelectBox.move(t+"_from",t+"_to"),void(o.selectedIndex=e===o.length?o.length-1:e)}(e.which&&40===e.which||e.keyCode&&40===e.keyCode)&&(o.selectedIndex=o.length===o.selectedIndex+1?0:o.selectedIndex+1),(e.which&&38===e.which||e.keyCode&&38===e.keyCode)&&(o.selectedIndex=0===o.selectedIndex?o.length-1:o.selectedIndex-1)}},window.addEventListener("load",function(e){document.querySelectorAll("select.selectfilter, select.selectfilterstacked").forEach(function(e){const t=e.dataset;SelectFilter.init(e.id,t.fieldName,parseInt(t.isStacked,10))})});